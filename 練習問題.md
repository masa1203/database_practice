# 練習問題を解く

## 1.1　テーブル作成

``` BASH
CREATE TABLE Jyushoroku (
    toroku_bango int NOT NULL,
    namae VARCHAR(128) NOT NULL,
    jyusho VARCHAR(256) NOT NULL,
    PRIMARY KEY(toroku_bango)
);
```

## 1.2 カラム追加

``` BASH
ALTER TABLE Jyushoroku ADD COLUMN (
    yubin_bango CHAR(8) NOT NULL
);
```

## 1.3 テーブル削除

``` BASH
DROP TABLE Jyushoroku
```

## 1.4 テーブルの復活

テーブルを削除すると復活できないので作り直すしかない

``` BASH
CREATE TABLE Jyushoroku (
    toroku_bango int NOT NULL,
    namae VARCHAR(128) NOT NULL,
    jyusho VARCHAR(256) NOT NULL,
    yubin_bango CHAR(8) NOT NULL,
    PRIMARY KEY(toroku_bango)
);
```

## 2.1　商品の選択

``` BASH
select shohin_mei, torokubi
from Shohin
where torokubi > '2009-04-28';
+--------------------+------------+
| shohin_mei         | torokubi   |
+--------------------+------------+
| Tシャツ            | 2009-09-20 |
| 穴あけパンチ       | 2009-09-11 |
| 包丁               | 2009-09-20 |
| フォーク           | 2009-09-20 |
| ボールペン         | 2009-11-11 |
+--------------------+------------+
5 rows in set (0.00 sec)
```

## 2.2 NULLの扱い

NULLは比較演算子で扱えないので返り値はEmptyとなる

select * from Shohin where shiire_tanka = NULL;
select * from Shohin where shiire_tanka <> NULL;
select * from Shohin where shiire_tanka > NULL;

## 2.3 販売単価が仕入単価よりも500円以上高い

``` BASH
select shohin_mei, hanbai_tanka, shiire_tanka
from Shohin
where hanbai_tanka - shiire_tanka >= 500;
+-----------------------+--------------+--------------+
| shohin_mei            | hanbai_tanka | shiire_tanka |
+-----------------------+--------------+--------------+
| Tシャツ               |         1000 |          500 |
| カッターシャツ        |         4000 |         2800 |
| 圧力なべ              |         6800 |         5000 |
+-----------------------+--------------+--------------+
3 rows in set (0.00 sec)

# 1通り目
select shohin_mei, hanbai_tanka, shiire_tanka
from Shohin
where hanbai_tanka >= shiire_tanka + 500;

# 2通り目
select shohin_mei, hanbai_tanka, shiire_tanka
from Shohin
where 500 - hanbai_tanka <= -1*shiire_tanka;
```

## 2.4 論理演算子

``` BASH
select shohin_mei, shohin_bunrui,
    hanbai_tanka * 0.9 - shiire_tanka as rieki
from Shohin
where hanbai_tanka * 0.9 - shiire_tanka> 100
and (shohin_bunrui = '事務用品' or shohin_bunrui = 'キッチン用品');
```

## 3.1 select文のおかしいところ

``` BASH
select shohin_id, sum(shohin_mei)
-- このselect文は間違っている
from Shohin
group by shohin_bunrui
where torokubi > '2009-09-01'
```

- shohin_meiはchar型なのにsum関数をつかっている
- group by 句にselect句にはない列名を使用している
- group by 句はwhere句の後にかく

## 3.2 group by 句と比較演算子

hanbai_tankの合計がshiire_tankaの合計の1.5売より大きい商品分類を求めるSelect文を考える

``` BASH
select shohin_bunrui, sum(hanbai_tanka), sum(shiire_tanka)
from Shohin
group by shohin_bunrui
having sum(hanbai_tanka) > sum(shiire_tanka) * 1.5;
+---------------+-------------------+-------------------+
| shohin_bunrui | sum(hanbai_tanka) | sum(shiire_tanka) |
+---------------+-------------------+-------------------+
| 衣服          |              5000 |              3300 |
| 事務用品      |               600 |               320 |
+---------------+-------------------+-------------------+
2 rows in set (0.01 sec)

```

## 3.3 order by 句

どんなorder by 句だったのか考える

``` BASH
select shohin_id, shohin_mei, shohin_bunrui, hanbai_tanka, shiire_tanka, torokubi
from Sohin;
+-----------+-----------------------+--------------------+--------------+--------------+------------+
| shohin_id | shohin_mei            | shohin_bunrui      | hanbai_tanka | shiire_tanka | torokubi   |
+-----------+-----------------------+--------------------+--------------+--------------+------------+
| 0001      | Tシャツ               | 衣服               |         1000 |          500 | 2009-09-20 |
| 0002      | 穴あけパンチ          | 事務用品           |          500 |          320 | 2009-09-11 |
| 0003      | カッターシャツ        | 衣服               |         4000 |         2800 | NULL       |
| 0004      | 包丁                  | キッチン用品       |         3000 |         2800 | 2009-09-20 |
| 0005      | 圧力なべ              | キッチン用品       |         6800 |         5000 | 2009-01-15 |
| 0006      | フォーク              | キッチン用品       |          500 |         NULL | 2009-09-20 |
| 0007      | おろし金              | キッチン用品       |          880 |          790 | 2008-04-28 |
| 0008      | ボールペン            | 事務用品           |          100 |         NULL | 2009-11-11 |
+-----------+-----------------------+--------------------+--------------+--------------+------------+
8 rows in set (0.00 sec)

# これにorder by 句を追加する
select shohin_id, shohin_mei, shohin_bunrui, hanbai_tanka, shiire_tanka, torokubi
from Shohin
order by torokubi desc, hanbai_tanka;
```
